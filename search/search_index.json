{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":"<p>Fibre Channel Theory</p> <p>Fibre channel was originally conceived as a replacement for existing legacy networking technologies like Ethernet and FDDI and was intended for backbone connections. In the early 1990s IBM had developed a fast and reliable storage interface technology (SSA) and Seagate needed a technology to compete; fibre channel was adapted c. 1994 and rapidly became the market leader. It was one of the first technologies developed for this purpose.</p> <p>At time of writing, Fibre Channel is standardized by the Technical Committee T11 (T11) of the International Committee for Information Technology Standards (INCITS). You should have previously covered SCSI; fibre channel uses SCSI as its application protocol. The physical topology is normally based on fibre optic cables but there are several choices based on the application; see topologies later in these notes.</p> <p>Fibre Channel is still used for very high-performance systems; Fibre Channel Protocol (FCP) is ideal for low latency and high throughput applications; it was specifically designed for that. However commercially, the market for the equipment seems to be stagnating. This technology will be around for the rest of my career, but I do not see its penetration increasing. It is expensive and complex, and its complexity is unique to itself as compared to the ubiquity of conventional networking with ethernet and TCP/IP. Fibre Channel over Ethernet (FCoE) does use conventional technology for transport; however, I see very little penetration of this technology. In terms of volume shipments, iSCSI seems to be currently winning this race.</p> <p>In these notes I will introduce fibre channel concisely not comprehensively. In my experience equipment and functionality differs from manufacturer to manufacturer and each implementation which uses different equipment tends to be a bit unique! The content covered here should be generic and enough to give you a starting point on any real system.</p> <p>I am not going to cover more complex issues, like fibre channel routing, ALUA/path optimization or MPIO.</p>"},{"location":"Fundamentals/a/","title":"Components","text":"<p>A fibre channel SAN has nodes which can be servers or storage. The node port on a server is normally provided by a host-bus adapter or HBA with two paths, one for transmit and one for receive</p> Fig 1. Server. <p>Every device has an 8-byte World Wide Name (WWN), the fibre channel equivalent to a MAC address. A node has a World-Wide Node Name (WWNN) and a switch port has a World-Wide Port Name (WWPN). A node which will consume storage is called an initiator. A node which will provide storage is called a target.</p> <p>Typically, we will have two ports on a Host Bus Adapter (HBA) for redundancy and load balancing. Two separate single port HBA cards would also be an option. Do an Internet search on EMC\u2019s PowerPath software to see the kind of things we can do by having two ports.</p> <p>We have specific cabling and connectors we can use. Typically, this will be a fibre optic cable, most commonly bright blue in color for modern fibre (OM3, 4, 5). Legacy fibres are bright orange. There are two types of fibre cables we can use.</p> <p>Multimode fibre is common on LANs and for short inter-connects and is the most common way of interconnecting with Fibre Channel.</p> <p>Single mode fibre has much more expensive transceivers but is good for links of typically up to 10km. At this point, read the accompanying notes on fibre types and connectors.</p> <p>We can also connect Fibre Channel over copper cables. This will generally be much cheaper but is good for very short distances only. We have interconnecting devices such as directors, switches, and hubs.  - Hubs provide very limited connectivity and scalability but are very cheap.  - Switches are intelligent, complex, and expensive! Switches normally have a fixed port count and configuration.  - Directors are modular and can be expanded using line cards or blades. </p> <p>High end switches and directors will normally be high availability and have redundant components. When switches are interconnected, they do so with an awareness of each other and in a tightly integrated way. One switch becomes the principal switch of a single integrated entity; we call this a fabric (different references spell principal and principle!!). A switch cannot forward between fabrics, this requires a fibre channel router. Each fabric has its own addressing scheme and a router uses FC-NAT to translate between them.</p> <p>We will generally have management software which presents the entire storage architecture as a single management interface. Typically, the topology will be visible as will the management status of all devices. For anything other than trivial systems, there will be separate, independent, redundant fabrics.</p> <p>In such a large and scalable environment, there should be some way of restricting access between initiators and targets; the fibre channel equivalent of a VLAN. This is the concept of zones, segments of the fabric where devices can communicate with each other. There is a section on zoning later in these notes.</p>"},{"location":"Fundamentals/b/","title":"Port Types","text":"<p>Each port in a fibre channel topology can have a type which determines its function and the protocols it uses. Physically, the ports are all probably identical, however when you define a port type, you define the protocols it supports. Note that some port types are manufacturer dependent and you may not find all these port types on new equipment; you may find port types that I have not mentioned. In every case go back to the manufacturer\u2019s documentation for the equipment you are working with.</p> Type Description N-Port A node port allows for the connection of an end device (server, SAN) F-Port A fabric port, the port on a switch that an N-node device plugs into L-Port An arbitrated loop port NL-Port Can act as an N or L port FL-Port Allows a fabric to connect to an arbitrated loop E-Port Expansion port allows two FC switches to connect G-Port Generic, a port which configures automatically as any other type B-Port Allows switches to connect via ATM M-Port Mirror port U-Port Universal Port, the base port"},{"location":"Fundamentals/c/","title":"Topologies","text":"<p>Three different topologies are standardized. - Fabric (FC-SW) - Arbitrated Loop (FC-AL) - Point to point (FC-PtP)</p>"},{"location":"Fundamentals/c/#fc-sw","title":"FC-SW","text":"<p>A fabric topology includes one or more fibre channel switches and allows any devices to communicate simultaneously, both ways. Connections are crossed so that RX on one side connects to TX on the other.  One of the oldest companies in this business is called Brocade\u2026which is a fabric.</p> Fig 2. Simple fabric. <p>Switches can be linked together, and we call these inter-switch links or ISLs.  These use completely different protocols from host port connections. Very large switches for enterprise use are called directors. Even a small deployment will normally have redundant paths and components and will be designed without a single point of failure, for high availability.</p> Fig 3. Redundant fabric."},{"location":"Fundamentals/c/#fc-al","title":"FC-AL","text":"<p>In an arbitrated loop, a unidirectional ring is constructed which allows any two devices to communicate with each other  one way at a time.  The output channel of one device is connected to the input channel of the next device in the loop. In some cases, a FC hub may be used as a concentrator to simplify wiring. Hubs have some of the same advantages  as the network devices of the same name.  For example, they can bridge a defective device, leaving the rest of the loop still functional.</p> Fig 4. Arbitrated loop. <p>As with network devices, we can have unmanaged, managed and switched hubs.  A switched hub is almost a switch and can connect devices at wire speed, duplex.  However, they do not support many of the features typical in a switch, such as zoning. The average throughput per server is the line speed divided by the number of nodes.  For example, on a 2GFC system with 8 nodes, 200MB/s divided by 8 gives an average bandwidth per node of 25MB/s. Up to 126 nodes are supported. Two types of arbitrated loop exist. A private loop closes on itself as shown in the diagram and each device has an L port. A public loop connects to a fabric via at least one switch and end devices must have an NL port supporting both fabric and arbitrated loop.</p>"},{"location":"Fundamentals/c/#fc-ptp","title":"FC-PtP","text":"<p>A point-to-point topology allows bi-directional communications to occur between two devices.  Connections are crossed so that RX on one side connects to TX on the other.</p> Fig 5. Point to Point."},{"location":"Fundamentals/d/","title":"Redundant Topologies","text":"<p>As noted previously, for high availability all nontrivial systems will be configured with dual redundant fabrics. That does not mean we are restricted from having redundant links within a fabric, it just means that in our planning, we never cross connect between two fabrics. This causes a lack of diversity and potentially introduces single points of failure.</p> <p>The simplest fabric is two switches connected and this suffices for a simple site. Assume every node has at least a two port HBA, and for high availability, each port connects to a separate fabric. Separate fabrics have absolutely no dependencies or interconnects. If you do erroneously join two fabrics, this should generate an error, a zoning database conflict, and the port should disable.</p> Fig 6. Simple Fabric. <p>Switches can be connected in a line, with two lines/fabrics.</p> Fig 7. Two lines. <p>Once sites become more complex. A core-to-edge fabric topology becomes normal, with a director at the centre of the fabric and switches connected back in a star topology. If we do this with a second director, then there is a dual-redundant A and B network with no overlap.</p> Fig 8. Director x 2. <p>On large installs, the topology looks almost like a leaf-spine in conventional networking. You could locate a director at either end of a row of cabinets, and place two redundant Top of Rack (ToR) fibre channel switches in each cabinet in the row. This is no simple design, you could make it more complex, each of the switches shown in the diagram could connect multiple other switches.</p>"},{"location":"Fundamentals/e/","title":"Fabric Shortest Path First","text":"<p>There are some advantages to having mesh connections, however most designs only use a single path. From an availability perspective, separate fabrics will give a much better result than a messy mesh.</p> Fig 9. Mesh. <p>The same logic applies, whether we are using a full mesh or partial mesh. In almost every case only a single path will be used at any one time between initiator and target. A routing protocol, Fibre Shortest Path First (FSPF) ensures this. FSPF is a link state routing protocol originally created by Brocade and is like OSPF as used in conventional networking. The domain ID which is associated with each unique switch in a fabric, acts as the routing ID of the switch. When you dig into the operation, the principal switch has a database, each switch is a hop and each ISL has a cost based on its bandwidth. The result is a loop-free topology. Routes are unidirectional, and it is possible to have different outbound and return paths.</p> <p>I have never had to manually tinker with FSPF, it is on by default and automatically calculates the best path between any two switches on the fabric. It dynamically computes the shortest and quickest path to a fabric and identifies alternative paths in the event of a failure of the optimal path. There is an equivalent to ECMP, and in some cases traffic can be distributed over multiple ISL\u2019s.</p> <p>In previous examples I have shown the optimal design to use separate fabrics. However as with a spanning tree-based conventional network, adding redundant links from switch to switch within a fabric is an appropriate design and will improve availability. Doing this optimally can be complex and in every case, you need to read the manufacturers recommendations. For example, with Cisco equipment, we can bond redundant fibre channel links on ISL\u2019s between switches as a port channel, like the way we do link aggregation on a conventional network. ISL trunking is available between switches and again, configuration is very dependent on a manufacturer\u2019s implementation.</p> <p>For redundancy, design with two completely separate fabrics, A and B. Mesh within a fabric, but never between fabrics.</p>"},{"location":"Fundamentals/f/","title":"NVMeOF","text":"<p>All the technology we have discussed so far is legacy. Fibre channel is 30 years old, and the disk technology has its origins a good 10 years before that. SAS and SATA controllers are a bottleneck, and this problem is common to the entire computer industry. The most advanced off-the-shelf interface technology which has emerged is NVMe and although there is some confusion on modern motherboards, SAS/SATA are not compatible with NVMe. This technology connects extremely fast flash-based storage directly with the PCI-e bus of the underlying computer hardware.</p> <p>All the storage technologies we discussed so far in this course use the SCSI command language. NVMe has its own command language, the first real move from SCSI in my working lifetime.</p> <p>NVMeOF is NVMe over Fabric, it allows NVMe commands to be communicated across the network, giving all the advantages of mature fibre channel standards, and the fastest available storage technology.</p> <p>At time of writing this is leading-edge technology. Look at NetApps website and look for the information on their NVMe technology. </p>"},{"location":"Protocol/g/","title":"Protocol Stack","text":"<p>To understand the terminology and configuration and to troubleshoot equipment, it is necessary to have at least some understanding of the fibre channel protocol stack. It is completely different to the seven-layer model from the OSI that we use when teaching conventional networking. </p> <p>Most complex architectures are written as a protocol stack. This allows us to interact at the most appropriate level whilst maintaining all the other levels unchanged.</p> <p>Fibre Channel was written as a fully integrated communications stack, it does not need to use IP, Ethernet, or any other conventional networking technology. However, for ease of support in operating systems and applications, it may be easiest to present the upper layers of applications as other standard protocols; this is performed by FC layer 4.</p> <p>Layers FC-0 to FC-3 implement the fibre channel transmission technology and the fundamental communication techniques.</p> Fig 10. Protocol Stack. <p>SCSI was a channel architecture; all devices were access through a specific channel, the SCSI bus. Channels have a single connection daisy-chaining all devices. All devices must be known, and they must share a common protocol, typically the SCSI command and response protocol.</p> <p>In a network architecture, any device can connect to any device.</p> <p>Most fibre channel is a combination of both architectures; it implements the SCSI protocol over the Fibre Channel network. Beware, there are proprietary versions which use other top-level protocols, for example, IBM\u2019s FICON.</p>"},{"location":"Protocol/h/","title":"FC-0","text":"<p>At the physical layer we have media, cables, and connectors.</p> <p>There are two groups of physical standards, the first increments as 2x and are called the Base2 standards. Each new standard must maintain backwards compatibility with the two previous standards. Long term compatibility is important, and the general feeling is that equipment will have a ten to twelve year lifetime before it is no longer useable with new equipment.</p> Product Each Way Speed T11 Specification Release Equipment Available 1GFC 100 MB/s 1996 1997 2GFC 200 MB/s 2000 2001 4GFC 400 MB/s 2003 2005 8GFC 800 MB/s 2006 2008 16GFC 1,600 MB/s 2009 2011 32GFC 3,200 MB/s 2012 2015 64GFC 6,400 MB/s 2016 2019 128GFC 12,800 MB/s 2022 3036 256GFC 25,600 MB/s <p>The second group increments as 10x and are called the Base10 standards and these maintain compatibility with the previous standard only.</p> Product Each Way Speed T11 Specification Release Equipment Available 10GFC 1200 MB/s 2003 2004 20GFC 2400 MB/s 2008 2008 40GFC 4800 MB/s 2009 2011 80GFC 9600 MB/s 100GFC 12000 MB/s 160GFC 19200 MB/s <p>As usual, you are guaranteed my notes will be out of date the day after I write them! Do check with an authoritative source for the latest information.</p> <p>Fibre channel assumes a very high-quality physical layer, with a bit error rate (BER) of no greater than one in every 1012 bits. The implication is that you will not pass the traffic over a WAN. The physical layer may use copper of fibre connections.</p>"},{"location":"Protocol/i/","title":"FC-1","text":"<p>8b/10b encoding is used at FC-1. Earlier technologies like Ethernet used Manchester Encoding, which was very inefficient.</p> <p>8b/10b encoding uses ten bit symbols to represent any  eight bit data pattern, and ensures that no more than five ones/zeros in a row can exist in a symbol, allowing both sides of a conversation to maintain timing and synchronization. Thus, a data rate of 100 MB/s requires a raw bit rate of around 1Gb/s.</p> <p>Symbols not used to represent data can be maintained for control and administration of the link.</p> <p>FC-1 uses two types of transmission word. A data word is a sequence of four bytes (forty bits in 8b/10b) between a start of file delimiter (SOF) and an end or file delimiter (EOF). Ordered sets are also contained between a SOF and EOF but are delimited by a special character with a unique bit sequence (K28.5). This allows an incoming bit stream to be divided into forty-bit words.</p> Fig 11. Frame."},{"location":"Protocol/j/","title":"FC-2","text":""},{"location":"Protocol/j/#switching-and-flow-control","title":"Switching and Flow Control","text":"<p>FC-2 is the data transfer layer and is responsible for data transfer and flow control. It establishes a range of service classes to support application requirements.</p> <p>End devices exchange information units. These are communications relating to an upper-level protocol like SCSI. To send information units, end devices are assigned an exchange for each communication which must occur, and these exchanges happen sequentially.</p> <p>A sequence is a collection of frames. One sequence is transferred after another in an exchange and the sequence is not complete until every one of its frames has been delivered. A sequence might (for example) be a file write to a SAN, or a database update and if a frame is missed, the whole sequence is repeated.        </p> Fig 12. Flow Control. <p>FC-2 guarantees that frames are delivered in the correct sequence and the frames themselves are very simple compared to Ethernet or TCP/IP. After the SOF there is a frame header with a destination and source address, a sequence ID, the number of frames in the sequence and the exchange ID. There is a data field with a payload of up to 2112 bytes and finally a CRC followed by an EOF. This is very efficient compared to Ethernet or TCP/IP with 98% of bits accounting for data.  </p> <p>Flow control exists and can be achieved between communicating ports or end-to-end.</p> <p>There are six service classes. </p> <ul> <li>Class 1 is a little bit like ATM; it is connection oriented and sets up a definite link before transmitting frames. </li> <li>Class 2 is a little bit like TCP, with end-to-end flow and link control. Each frame received is acknowledged. </li> <li>Class 3 is a bit like UDP, with no acknowledgements. </li> </ul> <p>The final three classes are not currently implemented and typically only class 2 and 3 are used.</p>"},{"location":"Protocol/k/","title":"FC-3","text":"<p>Although FC-3 appears in the standards and models, it is not implemented on any equipment I am familiar with.</p>"},{"location":"Protocol/l/","title":"FC-4","text":""},{"location":"Protocol/l/#upper-layer-protocol-mapping","title":"Upper Layer Protocol Mapping","text":"<p>Login, the assignment of addresses and the negotiation of service parameters happens at FC-4. It is at this point that a node can ascertain if it is part of a point-to-point topology or is connected to a fabric.  Low level addressing in FC is analogous to the MAC address of an Ethernet card and it is based on the allocation of 64-bit names, called World-Wide Names or WWNs. Each company has a 24 bit organizationally unique identifier or OUI included in the WWN. There are two types of WWN.</p> <p>Every node is assigned a World-Wide Node Name (WWNN) specific to that host. If there is a multi-port HBA, the WWNN is common across all ports.</p> <p>Every port is assigned a World-Wide Port Name (WWPN), the WWPN is burned into the individual port at manufacture, like a MAC address and it is globally unique.</p> <p>A node with a dual port HBA will have a single WWNN and two WWPNs. We normally assign an alias to the WWPN to make in human readable and more easy to work with.</p> <p>In a fabric, each WWPN is assigned a 24-bit port address during fabric login, which are used within FC frames as the source and destination IDs. In arbitrated loop, every WWPN is assigned an 8-bit address.</p> Fig 13. WW Names Array. Fig 14. WW Names HBA. <p>A fibre channel address is assigned by the switch during the fabric login process; this is analogous to an IP address.</p> <p>Each switch in a fabric is assigned a unique eight-bit domain ID (DID) by the principal switch in the fabric, of which 239 address are available. Fabric services reserve some of these addresses, we will see these later. This is analogous to the network part of an IP address. Switches must have unique DIDs before they can merge and hold a routing table which allows them to communicate across the fabric.</p> <p>In a large switch or director, we can have many ports. We can divide these into areas and 8 bits are available for area definition. 8 bits are available to distinguish between ports.</p> Eq 1. Nodes per fabric. <p>FC-4 provides the services which allow upper layer protocols (ULPs) to map services like SCSI into FC.</p>"},{"location":"Services/a/","title":"Summary","text":"<p>In a conventional network, Ethernet provides the transport on the local LAN. IP provides the transport between networks. For any effective use of the network, infrastructural services are required. On a conventional network, these minimal services include DNS, DHCP, NTP, SYSLOG, AAA. All these services are very much decoupled from the network, and could be provided by appliances, Linux servers, or in most enterprise networks provided via Active Directory.</p> <p>When multiple switches are connected via inter-switch links (ISL), a principal switch is automatically elected, and a fabric is formed. It is a little bit like the election that occurs in stacked ethernet switches. The principal switch maintains time for the fabric and manages domain ID assignments.</p> <p>In fibre channel the services are provided from the fibre channel fabric. A well-known address is reserved, three-byte address, unique for each service. A range of information and services is maintained by FC switches to facilitate the management of the network. Well defined addresses exist for each such service. This will be dealt with later in these notes.</p>"},{"location":"Services/b/","title":"List","text":"<p>The following services are available on any fibre channel network.</p> Address Function Description 0xFFFFFF Broadcast address 0xFFFFFE Fabric login server Used during the initial part of the node\u2019s login process 0xFFFFFD Fabric controller Manages Registered State Change Notifications (RSCN) which keep name servers updated on all switches 0xFFFFFC Name server or Directory server Responsible for name registration and management of node ports 0xFFFFFB Time server Since time to the member switches in the fabric from the principal switch 0xFFFFFA Management server Manages the fabric. This is the only service which is user configurable. It provides an un-zoned view of the overall fabric configuration. 0xFFFFF9 QoS server 0xFFFFF8 Alias server 0xFFFFF7 Key distribution server 0xFFFFF6 Clock synchronization server 0xFFFFF5 Multicast server"},{"location":"Services/c/","title":"Zoning","text":"<p>When we take a fibre-channel switch out of the box, we normally expect that it will have no zones defined; this is open zoning and for anything other than trivial cases, this is too simple for us to use. We can allocate servers/hosts/initiators and storage/targets to zones. Zoning allows for the creation of subnetworks within a fibre channel infrastructure. Some discrepancies exist in the terminology and functionality from different manufacturers. Zones can overlap, and a device may be in more than one zone. We can allocate initiators and targets to zones by their WWNs; WWN Zoning. In this case, the zoning can withstand changes in cabling or topology; the correct devices will always remain in the correct zones. The downside is that if we change a part on a server (like an HBA) it will no longer work in its original zone. We can allocate based on port addresses to zones in which case the topology is fixed, but it will work in the event of part changes; Port-Based Zoning. We can also zone hybrids and use both strategies within a zone.</p> <ul> <li>A Zone Set comprises a list of zones or nodes that can talk to each other.</li> <li>A Zone Alias can be created to refer to a group of devices in the fabric. For example, suppose I have a cluster of ESXi servers which all need to see the same backing store. I could give this cluster a Zone Alias on the fibre Channel network and treat the entire group of servers as a single entity.</li> </ul> <p>With soft zoning, the fabric name service determines which devices are in which zones. When an initiator server asks about a target/storage, it will only be told about the storage which is in the zones to which it has access. However, the devices in other zones are still accessible if the server knows the port address of the other devices. </p> <p>Where a server has a persistent record of the devices on an FC network, soft zoning will not remove the ability to access these devices.</p> <p>With hard zoning, you can only access the devices with which you share a common zone. Typically, we allocate to hard zones based on port addresses; in networking terms this is frame filtering.</p> <p>We can also have virtual FC networks, where the same physical components are shared in a multi-tenancy. Virtual FC networks are logically separate and the name server of one is not visible to the devices on another. In the example below, I use Ix and Tx as aliases for WWPNs.</p> <ul> <li>Fabric A will have a zone I1-T1 with the WWPN of node I1 and T1.</li> <li>Fabric B will have a zone I2-T2 with the WWPN of node I2 and T2.</li> </ul> <p>If the server ESXi01 becomes part of a cluster CLUST01 and SAN1 provides shared storage, the other hosts HBA\u2019s could be added to the zone. You can also zone from a target on some SAN equipment. If there were a second cluster CLUST02, I would create a second zone, so that the servers could connect to the storage, but not connect to the other cluster. I could then aggregate these zones into a zone set.</p> Fig 15. Masking."},{"location":"Services/d/","title":"LUN Masking","text":"<p>In the previous example, we prevented unauthorized hosts from accessing each other. We also explicitly stated which hosts could access the Target/SAN. But the target exposes multiple LUNs, we also need to protect these, so only the appropriate server can access the appropriate LUN.</p> <p>LUN masking is implemented on the SAN. In the example above, I would create a LUN for CLUST01 and implement LUN masking so that only the WWPNs of the servers in CLUST01 could access it. I would create a second LUN for CLUST02 and set LUN masking appropriate to the WWPNs of the server in CLUST02.</p> <p>In a production system, zoning and LUN masking should be implemented.</p>"},{"location":"Services/e/","title":"Virtualization","text":""},{"location":"Services/e/#virtualization-in-the-fabric","title":"Virtualization in the fabric","text":"<p>One approach to building a reliable infrastructure is to virtualize the switch. Very simply you partition the switch or director into two or more separate logical devices. You treat them as if they are separate switches/fabrics and do not interconnect with the physical fibre. Although there are still dependencies in hardware, this is a very useful technique.</p>"},{"location":"Services/e/#virtualization-in-the-san","title":"Virtualization in the SAN","text":"<p>Physical LUNs are presented to a virtualization layer in the SAN, which then exposes LUNs and block storage to the servers which require it. The virtualization layer of the SAN appears as if it is a host to the storage array. It appears as if it is a SAN to the servers.</p> Fig 16. Virtualization. <p>Although this may seem overly complex, this can be very useful. For example, when I am moving physical storage for service and maintenance, I need to move LUNs from one SAN to another. I could do this several ways, but the easiest would be to copy the LUN from one SAN to another and then change the backing to the virtual volume.</p> <p>I could also add storage to a virtual volume very easily by making it available at the backend and merging it at the virtual volume layer.</p> <p>We can have a virtual SAN. We can set up a fabric as if it were multiple switches, each with its own domain name, name servers, zoning, etc. This has all the same advantages we use virtualization for in other technologies, such as scalability, management, security, etc. Two or more completely different SANs can live on the same physical infrastructure. Virtual SAN technology has different trade names and is implemented slightly differently from manufacturer to manufacturer.</p>"},{"location":"Services/f/","title":"Fabric Login","text":"<p>The fabric login server assigns a fabric address to each fabric node. The fabric address is a 24-bit address containing 3 x three-byte nodes.</p> <ul> <li>The domain ID representing each separate switch in the fabric.</li> <li>The port area number of the port where the node is attached.</li> <li>The arbitrated loop physical address if it exists, or the port ID.</li> </ul> <p>When storage or host devices are powered on and connected, they must login to the fabric. When a fabric login (FLOGI) occurs, it establishes a session between an N-port and an F-port. The node sends a FLOGI frame with its WWN to the fabric login server on the switch and a 24-bit Fibre Channel ID (FCID) address is assigned. The FCID is constructed from the switch\u2019s domain ID and the switch port the host is plugged into. If the WWN is a little bit like a MAC address, then the FCID could be considered like an IP address. Switches maintain a table with WWPN to FCID mappings and the FCID is used across the fabric for routing.</p> <p>The N-port registers with the fibre channel name server (FCNS) on the switch, indicating its WWN, port type and FC address. A port login (PLOGI) now occurs between two end nodes to exchange service parameters and logs the device into the name server to register its information and query for other devices that share the same zone. The node is now connected.  Once a node has completed fabric and port login, it can query the name server and identify other nodes to connect to.</p> <p>A process login (PRLI) can now occur between the application stacks on the two end nodes. This all sounds mildly complicated compared to conventional networking; but it is not! We have just done the equivalent of all the ethernet, IP, DHCP, DNS, service discovery and AAA required in the fibre channel network. And it all works out of the box without any user intervention, at least on simple networks; sometimes!</p> <p>All this functionality gives the fabric base information which can be used for more complicated tasks which we will not be covering, like path optimization and MPIO.</p> <p>When two switches are connected, the login process is a little different. Switches exchange frames to establish the connection which uses an E port. An initialization frame, called the Exchange Link Parameters (ELP) frame is exchanged. This is not a negotiation and if parameters do not match a link does not occur. Once an acknowledgement frame is received the switches transmit Exchange Switch Capabilities (ESC) frames, exchanging routing protocols and agreeing on a common routing protocol. After acknowledgement, an Exchange Fabric Parameters (EFP) frame is transmitted requesting principal switch priority and a domain ID list.</p> <p>A Registered State Change Notification (RSCN) is a notification frame used to notify all devices of fabric changes.</p>"}]}